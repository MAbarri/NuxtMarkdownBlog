import{a3 as e,al as r,b3 as a,aH as t,b1 as n,bd as s,au as i,bi as o,B as l,bj as u}from"../runtime.mjs";import{e as c,k as d,g as p,l as y,j as f}from"./server.mjs";import{u as m}from"./preview-wkaBPEZ5.mjs";import{g as h,C as g}from"../routes/renderer.mjs";function useAsyncData(...t){var n,s,o,l,u,p,f,m;const v="string"==typeof t[t.length-1]?t.pop():void 0;"string"!=typeof t[0]&&t.unshift(v);let[w,_,D={}]=t;if("string"!=typeof w)throw new TypeError("[nuxt] [asyncData] key must be a string.");if("function"!=typeof _)throw new TypeError("[nuxt] [asyncData] handler must be a function.");const b=c(),P=_;D.server=null==(n=D.server)||n,D.default=null!=(s=D.default)?s:()=>d.value,D.getCachedData=null!=(o=D.getCachedData)?o:()=>b.isHydrating?b.payload.data[w]:b.static.data[w],D.lazy=null!=(l=D.lazy)&&l,D.immediate=null==(u=D.immediate)||u,D.deep=null!=(p=D.deep)?p:d.deep,D.dedupe=null!=(f=D.dedupe)?f:"cancel";const j=D.getCachedData(w,b),x=null!=j;if(!b._asyncData[w]||!D.immediate){null!=(m=b.payload._errors)[w]||(m[w]=d.errorValue);const t=D.deep?e:r;b._asyncData[w]={data:t(x?j:D.default()),pending:e(!x),error:a(b.payload._errors,w),status:e("idle"),_default:D.default}}const C={...b._asyncData[w]};delete C._default,C.refresh=C.execute=(e={})=>{var r,a;if(b._asyncDataPromises[w]){if("defer"===(a=null!=(r=e.dedupe)?r:D.dedupe)||!1===a)return b._asyncDataPromises[w];b._asyncDataPromises[w].cancelled=!0}if(e._initial||b.isHydrating&&!1!==e._initial){const r=e._initial?j:D.getCachedData(w,b);if(null!=r)return Promise.resolve(r)}C.pending.value=!0,C.status.value="pending";const t=new Promise(((e,r)=>{try{e(P(b))}catch(e){r(e)}})).then((async e=>{if(t.cancelled)return b._asyncDataPromises[w];let r=e;D.transform&&(r=await D.transform(e)),D.pick&&(r=function(e,r){const a={};for(const t of r)a[t]=e[t];return a}(r,D.pick)),b.payload.data[w]=r,C.data.value=r,C.error.value=d.errorValue,C.status.value="success"})).catch((e=>{if(t.cancelled)return b._asyncDataPromises[w];C.error.value=y(e),C.data.value=i(D.default()),C.status.value="error"})).finally((()=>{t.cancelled||(C.pending.value=!1,delete b._asyncDataPromises[w])}));return b._asyncDataPromises[w]=t,b._asyncDataPromises[w]},C.clear=()=>function(e,r){r in e.payload.data&&(e.payload.data[r]=void 0);r in e.payload._errors&&(e.payload._errors[r]=d.errorValue);e._asyncData[r]&&(e._asyncData[r].data.value=void 0,e._asyncData[r].error.value=d.errorValue,e._asyncData[r].pending.value=!1,e._asyncData[r].status.value="idle");r in e._asyncDataPromises&&(e._asyncDataPromises[r]&&(e._asyncDataPromises[r].cancelled=!0),e._asyncDataPromises[r]=void 0)}(b,w);if(!1!==D.server&&b.payload.serverRendered&&D.immediate){const e=C.refresh({_initial:!0});h()?g((()=>e)):b.hook("app:created",(async()=>{await e}))}const $=Promise.resolve(b._asyncDataPromises[w]).then((()=>C));return Object.assign($,C),$}const get=(e,r)=>r.split(".").reduce(((e,r)=>e&&e[r]),e),_pick=(e,r)=>Object.keys(e).filter(r).reduce(((r,a)=>Object.assign(r,{[a]:e[a]})),{}),omit=e=>r=>e&&e.length?_pick(r,(r=>!e.includes(r))):r,apply=e=>r=>Array.isArray(r)?r.map((r=>e(r))):e(r),detectProperties=e=>{const r=[],a=[];for(const t of e)["$","_"].includes(t)?r.push(t):a.push(t);return{prefixes:r,properties:a}},withoutKeys=(e=[])=>r=>{if(0===e.length||!r)return r;const{prefixes:a,properties:t}=detectProperties(e);return _pick(r,(e=>!t.includes(e)&&!a.includes(e[0])))},withKeys=(e=[])=>r=>{if(0===e.length||!r)return r;const{prefixes:a,properties:t}=detectProperties(e);return _pick(r,(e=>t.includes(e)||a.includes(e[0])))},sortList=(e,r)=>{const a=new Intl.Collator(r.$locale,{numeric:r.$numeric,caseFirst:r.$caseFirst,sensitivity:r.$sensitivity}),t=Object.keys(r).filter((e=>!e.startsWith("$")));for(const n of t)e=e.sort(((e,t)=>{const s=[get(e,n),get(t,n)].map((e=>{if(null!==e)return e instanceof Date?e.toISOString():e}));return-1===r[n]&&s.reverse(),a.compare(s[0],s[1])}));return e},assertArray=(e,r="Expected an array")=>{if(!Array.isArray(e))throw new TypeError(r)},ensureArray=e=>Array.isArray(e)?e:[void 0,null].includes(e)?[]:[e],v=["sort","where","only","without"];function createQuery(e,r={}){const a={};for(const e of Object.keys(r.initialParams||{}))a[e]=v.includes(e)?ensureArray(r.initialParams[e]):r.initialParams[e];const $set=(e,r=e=>e)=>(...n)=>(a[e]=r(...n),t),resolveResult=e=>{var a;return r.legacy?(null==e?void 0:e.surround)?e.surround:e?((null==e?void 0:e.dirConfig)&&(e.result={_path:null==(a=e.dirConfig)?void 0:a._path,...e.result,_dir:e.dirConfig}),(null==e?void 0:e._path)||Array.isArray(e)||!Object.prototype.hasOwnProperty.call(e,"result")?e:null==e?void 0:e.result):e:e},t={params:()=>({...a,...a.where?{where:[...ensureArray(a.where)]}:{},...a.sort?{sort:[...ensureArray(a.sort)]}:{}}),only:$set("only",ensureArray),without:$set("without",ensureArray),where:$set("where",(e=>[...ensureArray(a.where),...ensureArray(e)])),sort:$set("sort",(e=>[...ensureArray(a.sort),...ensureArray(e)])),limit:$set("limit",(e=>parseInt(String(e),10))),skip:$set("skip",(e=>parseInt(String(e),10))),find:()=>e(t).then(resolveResult),findOne:()=>e($set("first")(!0)).then(resolveResult),count:()=>e($set("count")(!0)).then(resolveResult),locale:e=>t.where({_locale:e}),withSurround:$set("surround",((e,r)=>({query:e,...r}))),withDirConfig:()=>$set("dirConfig")(!0)};return r.legacy?(t.findSurround=(e,r)=>t.withSurround(e,r).find().then(resolveResult),t):t}function jsonStringify(e){return JSON.stringify(e,regExpReplacer)}function regExpReplacer(e,r){return r instanceof RegExp?`--REGEX ${r.toString()}`:r}const encodeQueryParams=e=>{let r=jsonStringify(e);r=void 0!==l?l.from(r).toString("base64"):btoa(r),r=r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return(r.match(/.{1,100}/g)||[]).join("/")},withContentBase=e=>u(e,p().public.content.api.baseURL),useContentDisabled=()=>{throw console.warn("useContent is only accessible when you are using `documentDriven` mode."),console.warn("Learn more by visiting: https://content.nuxt.com/document-driven"),new Error("useContent is only accessible when you are using `documentDriven` mode.")},addPrerenderPath=e=>{const r=f();r&&r.node.res.setHeader("x-nitro-prerender",[r.node.res.getHeader("x-nitro-prerender"),e].filter(Boolean).join(","))},shouldUseClientDB=()=>(p().public.content,!1);function queryContent(e,...r){const{content:a}=p().public,i=createQuery((async e=>{const{content:r}=p().public,a=e.params(),t=r.experimental.stripQueryParameters?withContentBase(`/query/${o(a)}.${r.integrity}/${encodeQueryParams(a)}.json`):withContentBase(`/query/${o(a)}.${r.integrity}.json`);if(addPrerenderPath(t),shouldUseClientDB())return(await import("./client-db-aqHWZo_4.mjs").then((e=>e.useContentDatabase()))).fetch(e);const n=await $fetch(t,{method:"GET",responseType:"json",params:r.experimental.stripQueryParameters?void 0:{_params:jsonStringify(a),previewToken:m().getPreviewToken()}});if("string"==typeof n&&n.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return n}),{initialParams:"string"!=typeof e?e:{},legacy:!0});let l;"string"==typeof e&&(l=t(n(e,...r)));const u=i.params;return i.params=()=>{var e,r,t;const n=u();if(l&&(n.where=n.where||[],n.first&&0===(n.where||[]).length?n.where.push({_path:s(l)}):n.where.push({_path:new RegExp(`^${l.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(null==(e=n.sort)?void 0:e.length)||(n.sort=[{_stem:1,$numeric:!0}]),a.locales.length){(null==(t=null==(r=n.where)?void 0:r.find((e=>e._locale)))?void 0:t._locale)||(n.where=n.where||[],n.where.push({_locale:a.defaultLocale}))}return n},i}export{useContentDisabled as a,addPrerenderPath as b,createQuery as c,assertArray as d,encodeQueryParams as e,ensureArray as f,get as g,sortList as h,apply as i,jsonStringify as j,withoutKeys as k,withKeys as l,omit as o,queryContent as q,shouldUseClientDB as s,useAsyncData as u,withContentBase as w};
//# sourceMappingURL=query-BgbUqyt0.mjs.map
